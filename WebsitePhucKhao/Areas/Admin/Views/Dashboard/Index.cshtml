@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

@section Styles {
    <link rel="stylesheet" href="~/css/admin/dashboard.css" />
}

<div class="d-content-wrapper">
    <div class="d-container-fluid">
        <!-- Header -->
        <div class="d-header">
            <h1>Dashboard</h1>
            <p>
                <i class="fas fa-calendar"></i>
                Học kỳ hiện tại: @ViewBag.HocKy
            </p>
            <p>
                <i class="fas fa-clock"></i>
                Cập nhật lúc: <span id="current-time"></span>
            </p>
        </div>

        <!-- Thống kê tổng quan -->
        <div class="d-stat-cards">
            <div class="d-stat-card d-stat-card-primary">
                <div class="d-stat-card-header">
                    <i class='bx bxs-graduation me-2'></i> Sinh viên
                </div>
                <div class="d-stat-card-body">
                    <div class="d-stat-card-icon">
                        <i class='bx bxs-graduation'></i>
                    </div>
                    <div>
                        <div class="d-stat-card-number">
                            @ViewBag.TotalStudents
                        </div>
                        <div class="d-stat-card-label">Tổng số sinh viên</div>
                    </div>
                </div>
            </div>

            <div class="d-stat-card d-stat-card-success">
                <div class="d-stat-card-header">
                    <i class='bx bxs-school me-2'></i> Giảng viên
                </div>
                <div class="d-stat-card-body">
                    <div class="d-stat-card-icon">
                        <i class='bx bxs-school'></i>
                    </div>
                    <div>
                        <div class="d-stat-card-number">
                            @ViewBag.TotalTeachers
                        </div>
                        <div class="d-stat-card-label">Tổng số giảng viên</div>
                    </div>
                </div>
            </div>

            <div class="d-stat-card d-stat-card-info">
                <div class="d-stat-card-header">
                    <i class='bx bxs-briefcase me-2'></i> Nhân viên
                </div>
                <div class="d-stat-card-body">
                    <div class="d-stat-card-icon">
                        <i class='bx bxs-briefcase'></i>
                    </div>
                    <div>
                        <div class="d-stat-card-number">
                            @ViewBag.TotalStaff
                        </div>
                        <div class="d-stat-card-label">Tổng số nhân viên</div>
                    </div>
                </div>
            </div>

            <div class="d-stat-card d-stat-card-warning">
                <div class="d-stat-card-header">
                    <i class='bx bxs-file-doc me-2'></i> Phúc khảo
                </div>
                <div class="d-stat-card-body">
                    <div class="d-stat-card-icon">
                        <i class='bx bxs-file-doc'></i>
                    </div>
                    <div>
                        <div class="d-stat-card-number">
                            @ViewBag.TotalAppeals
                        </div>
                        <div class="d-stat-card-label">Tổng số yêu cầu phúc khảo</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Thống kê phúc khảo -->
        <div class="d-card d-shadow">
            <div class="d-card-header">
                <h5 class="d-card-title"><i class="fas fa-chart-pie me-2"></i> Thống kê phúc khảo</h5>
            </div>
            <div class="d-card-body">
                <div class="d-table-responsive">
                    <table class="d-table d-table-striped d-table-bordered">
                        <thead>
                            <tr>
                                <th><i class="fas fa-info-circle me-1"></i> Trạng thái</th>
                                <th><i class="fas fa-hashtag me-1"></i> Số lượng</th>
                                <th><i class="fas fa-percentage me-1"></i> Tỷ lệ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <span class="d-badge d-badge-pill" style="background-color: #f6c23e; color: white;">
                                        <i class="fas fa-clock me-1"></i> Chờ xử lý
                                    </span>
                                </td>
                                <td>@ViewBag.PhucKhaoChoXuLy</td>
                                <td>
                                    <div class="d-progress">
                                        <div class="d-progress-bar" role="progressbar" style="width: @(ViewBag.TyLeChoXuLy)%">
                                            @(ViewBag.TyLeChoXuLy)%
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <span class="d-badge d-badge-pill" style="background-color: #4e73df; color: white;">
                                        <i class="fas fa-spinner me-1"></i> Đang xử lý
                                    </span>
                                </td>
                                <td>@ViewBag.PhucKhaoDangXuLy</td>
                                <td>
                                    <div class="d-progress">
                                        <div class="d-progress-bar" role="progressbar" style="width: @(ViewBag.TyLeDangXuLy)%">
                                            @(ViewBag.TyLeDangXuLy)%
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <span class="d-badge d-badge-pill" style="background-color: #1cc88a; color: white;">
                                        <i class="fas fa-check-circle me-1"></i> Hoàn thành
                                    </span>
                                </td>
                                <td>@ViewBag.PhucKhaoHoanThanh</td>
                                <td>
                                    <div class="d-progress">
                                        <div class="d-progress-bar" role="progressbar" style="width: @(ViewBag.TyLeHoanThanh)%">
                                            @(ViewBag.TyLeHoanThanh)%
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <span class="d-badge d-badge-pill" style="background-color: #e74a3b; color: white;">
                                        <i class="fas fa-times-circle me-1"></i> Từ chối
                                    </span>
                                </td>
                                <td>@ViewBag.PhucKhaoTuChoi</td>
                                <td>
                                    <div class="d-progress">
                                        <div class="d-progress-bar" role="progressbar" style="width: @(ViewBag.TyLeTuChoi)%">
                                            @(ViewBag.TyLeTuChoi)%
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Hoạt động gần đây -->
        <div class="d-card d-shadow">
            <div class="d-card-header">
                <h5 class="d-card-title"><i class="fas fa-history me-2"></i> Hoạt động gần đây</h5>
            </div>
            <div class="d-card-body">
                @if (ViewBag.HoatDongGanDay != null && ViewBag.HoatDongGanDay.Count > 0)
                {
                    <div class="d-table-responsive">
                        <table class="d-table d-table-striped d-table-bordered">
                            <thead>
                                <tr>
                                    <th><i class="fas fa-calendar-alt me-1"></i> Thời gian</th>
                                    <th><i class="fas fa-user me-1"></i> Người dùng</th>
                                    <th><i class="fas fa-tasks me-1"></i> Hành động</th>
                                    <th><i class="fas fa-info-circle me-1"></i> Chi tiết</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var hoatDong in ViewBag.HoatDongGanDay)
                                {
                                    <tr>
                                        <td>@hoatDong.ThoiGian.ToString("dd/MM/yyyy HH:mm")</td>
                                        <td>@hoatDong.NguoiDung</td>
                                        <td>@hoatDong.HanhDong</td>
                                        <td>@hoatDong.ChiTiet</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <div class="d-alert d-alert-info">
                        <i class="fas fa-info-circle me-2"></i> Không có hoạt động nào gần đây.
                    </div>
                }
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Hiển thị thời gian thực
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('vi-VN', { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit',
                hour12: false 
            });
            const dateString = now.toLocaleDateString('vi-VN', { 
                day: '2-digit', 
                month: '2-digit', 
                year: 'numeric' 
            });
            document.getElementById('current-time').textContent = `${dateString} ${timeString}`;
        }

        // Cập nhật thời gian mỗi giây
        updateCurrentTime();
        setInterval(updateCurrentTime, 1000);
    </script>
}
