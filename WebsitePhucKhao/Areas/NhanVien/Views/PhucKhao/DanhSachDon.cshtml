@model List<WebsitePhucKhao.Models.DonPhucKhao>
@using WebsitePhucKhao.Enums

@{
    ViewData["Title"] = "Tất cả đơn phúc khảo";
}

<div class="content-wrapper">
    <div class="container-fluid mt-4">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h3 class="card-title mb-0">
                    <i class="fas fa-list me-2"></i>Danh sách tất cả đơn phúc khảo
                </h3>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table id="donPhucKhaoTable" class="table table-striped table-bordered">
                        <thead>
                            <tr>
                                <th>Mã đơn</th>
                                <th>Mã sinh viên</th>
                                <th>Tên sinh viên</th>
                                <th>Môn học</th>
                                <th>Học kỳ</th>
                                <th>Năm học</th>
                                <th>Trạng thái</th>
                                <th>Ngày gửi</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var don in Model)
                            {
                                <tr>
                                    <td>@don.MaDon</td>
                                    <td>@don.MaSinhVien</td>
                                    <td>@don.SinhVien?.HoTen</td>
                                    <td>@don.MonHoc?.TenMonHoc</td>
                                    <td>@don.HocKy?.TenHocKy</td>
                                    <td>@don.NamHoc?.TenNamHoc</td>
                                    <td>
                                        @switch (don.TrangThai)
                                        {
                                            case TrangThaiPhucKhao.ChoXacNhan:
                                                <span class="badge bg-warning">Chờ xác nhận</span>
                                                break;
                                            case TrangThaiPhucKhao.DaDuyet:
                                                <span class="badge bg-success">Đã duyệt</span>
                                                break;
                                            case TrangThaiPhucKhao.ChoCham:
                                                <span class="badge bg-info">Chờ chấm</span>
                                                break;
                                            case TrangThaiPhucKhao.DaCham:
                                                <span class="badge bg-primary">Đã chấm</span>
                                                break;
                                            case TrangThaiPhucKhao.TuChoi:
                                                <span class="badge bg-danger">Từ chối</span>
                                                break;
                                            default:
                                                <span class="badge bg-secondary">@don.TrangThai.ToFriendlyString()</span>
                                                break;
                                        }
                                    </td>
                                    <td>@don.NgayGui.ToString("dd/MM/yyyy HH:mm")</td>
                                    <td>
                                        <a href="@Url.Action("ChiTietPhucKhaoChoNhanVien", new { id = don.MaDon })" 
                                           class="btn btn-sm btn-info" title="Xem chi tiết">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            $('#donPhucKhaoTable').DataTable({
                columnDefs: [
                    { targets: [0, 1, 7], width: '10%' },
                    { targets: [2, 3, 4, 5], width: '15%' },
                    { targets: [6], width: '12%' },
                    { targets: [8], width: '8%', orderable: false }
                ],
                order: [[7, 'desc']] // Sắp xếp theo ngày gửi giảm dần
            });
        });
    </script>
}
